!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["Upload JS"]=t():e["Upload JS"]=t()}(window,function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var r={textBtnUpload:"Ajouter un fichier",textBeforeUpload:"Aucun fichier sélectionné",textAfterUpload:"Vos fichiers",textSizeRest:"{{number}} restant{{s}}",textFileRest:"{{number}} fichier{{s}} restant{{s}}",textMaxFileSize:"{{number}} maximum par fichier",textFileNotValid:"Votre fichier n'est pas valide:",textMultipleFileNotValid:"Vos fichiers ne sont pas valides:",textFileTooBig:"Votre fichier est trop lourd:",textMultipleFileTooBig:"Vos fichiers sont trop lourd:",textTotalFilesSize:"Le poids total de vos fichiers est trop lourd.",textTooManyFiles:"Trop de fichiers téléchargés !",textTotalFiles:"La limite du nombre de fichier est atteinte",textErrorUpload:"Une erreur est survenue, impossible de télécharger le fichier."},s={textBtnUpload:"Add a file",textBeforeUpload:"No file selected",textAfterUpload:"Your files",textSizeRest:"{{number}} left",textFileRest:"{{number}} file{{s}} left",textMaxFileSize:"{{number}} maximum per file",textFileNotValid:"Your file is not valid",textMultipleFileNotValid:"Your file are not valid:",textFileTooBig:"Your file is too big",textMultipleFileTooBig:"Your files are too big",textTotalFilesSize:"Total files is too big",textTooManyFiles:"Too many files uploaded",textTotalFiles:"The limit has been reached",textErrorUpload:"Cannot upload the file"};function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,i){return t&&u(e.prototype,t),i&&u(e,i),e}i.d(t,"default",function(){return d});var c=function(){function e(){p(this,e),this.events={}}return h(e,[{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"emit",value:function(e,t){var i=this.events[e];i&&i.forEach(function(e){e.call(null,t)})}}]),e}(),d=function(e){function t(e){var i;p(this,t),(i=o(this,a(t).call(this))).options={selector:'input[type="file"]',maxFileSize:2,maxTotalFilesSize:10,maxNbFiles:5,limitCharacters:10,displayMaxFileSize:!0,displayRestSize:!0,displayRestFiles:!0,displayFilenameError:!0,multiple:!0,mimeType:!1,fileExtensions:[".jpg",".jpeg",".png",".pdf"],dropZone:!1,actionAjax:null,language:"fr",languages:{},customContentOnly:!1,customContent:""},i.text=[],i.text.fr=r,i.text.en=s,i.options=i._mergeObjects(i.options,e);var n=Object.keys(i.options.languages);return n.length&&n.forEach(function(e,t){i.text[e]?i._mergeObjects(i.text[e],i.options.languages[e]):i._compareKeys(i.options.languages[e],r)&&(i.text[e]=i.options.languages[e])}),i.currentFiles=[],i.filesList=[],i.currentErrors=[],i.maxTotalFilesSize,i.wrapperFiles,i.parentInput,i.wrapperInput,i.wrapperInformation,i.filesContent,i.fileInput,i.wrapperBtnUpload,i.btnUpload,i.wrapperSelected,i.wrapperError,i.maxFileSize,i.restSize,i.restFiles,i.progressBar,i.progressBarContent,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),h(t,[{key:"init",value:function(){var e=this;if(this.maxTotalFilesSize=1048576*this.options.maxTotalFilesSize,this.fileInput=document.querySelector(this.options.selector),this.fileInput){if(this.parentInput=this.fileInput.parentNode,this.wrapperInput=document.createElement("div"),this.wrapperInput.classList.add("w-input"),this.wrapperBtnUpload=document.createElement("div"),this.wrapperBtnUpload.classList.add("w-input__upload"),this.btnUpload=document.createElement("span"),this.btnUpload.innerHTML=this.text[this.options.language].textBtnUpload,this.parentInput.replaceChild(this.wrapperInput,this.fileInput),this.wrapperInput.appendChild(this.fileInput),this.wrapperInput.appendChild(this.wrapperBtnUpload),this.options.customContent&&this.options.customContentOnly||this.wrapperBtnUpload.appendChild(this.btnUpload),this.options.customContent){var t=(new DOMParser).parseFromString(this.options.customContent,"text/xml");this.wrapperBtnUpload.appendChild(t.firstChild)}(this.options.displayRestSize||this.options.displayRestFiles||this.options.displayMaxFileSize)&&(this.wrapperInformation=document.createElement("div"),this.wrapperInformation.classList.add("w-information"),this.parentInput.appendChild(this.wrapperInformation),this.options.displayRestSize&&(this.restSize=document.createElement("div"),this.restSize.classList.add("w-information__size"),this.restSize.innerHTML=this._getText(this.text[this.options.language].textSizeRest,this._getRestSize()),this.wrapperInformation.appendChild(this.restSize)),this.options.displayMaxFileSize&&(this.maxFileSize=document.createElement("div"),this.maxFileSize.classList.add("w-information__size-max"),this.maxFileSize.innerHTML=this._getText(this.text[this.options.language].textMaxFileSize,this._getFileSize(1048576*this.options.maxFileSize)),this.wrapperInformation.appendChild(this.maxFileSize)),this.options.displayRestFiles&&(this.restFiles=document.createElement("div"),this.restFiles.classList.add("w-information__files"),this.restFiles.innerHTML=this._getText(this.text[this.options.language].textFileRest,this.options.maxNbFiles),this.wrapperInformation.appendChild(this.restFiles))),this.wrapperFiles=document.createElement("div"),this.wrapperFiles.classList.add("w-files"),this.parentInput.appendChild(this.wrapperFiles),this.wrapperSelected=document.createElement("span"),this.wrapperSelected.classList.add("w-files__selected"),this.wrapperSelected.innerHTML=this.text[this.options.language].textBeforeUpload,this.wrapperFiles.appendChild(this.wrapperSelected),this.options.actionAjax&&(this.progressBar=document.createElement("div"),this.progressBar.classList.add("w-progress-bar"),this.progressBarContent=document.createElement("div"),this.progressBarContent.classList.add("w-progress-bar__content"),this.progressBar.appendChild(this.progressBarContent),this.parentInput.appendChild(this.progressBar)),this.options.multiple&&this.fileInput.setAttribute("multiple",!0),this.options.fileExtensions.length&&this.fileInput.setAttribute("accept",this.options.fileExtensions),this.fileInput.addEventListener("change",this._addNewFile.bind(this)),this.wrapperBtnUpload.addEventListener("click",function(){e.fileInput.click()},!1),this.options.dropZone?this._initDropZone():this.emit("init",{init:!0})}}},{key:"_initDropZone",value:function(){var e=this,t=!1;this.wrapperBtnUpload.addEventListener("dragover",function(){event.preventDefault(),e.parentInput.classList.add("is-dragover")},!1),this.wrapperBtnUpload.addEventListener("dragenter",function(){e.parentInput.classList.add("is-dragover")},!1),this.wrapperBtnUpload.addEventListener("dragleave",function(){e.parentInput.classList.remove("is-dragover")},!1),this.wrapperBtnUpload.addEventListener("dragend",function(){e.parentInput.classList.remove("is-dragover")},!1),this.wrapperBtnUpload.addEventListener("drop",function(i){i.preventDefault(),i.stopPropagation(),e.parentInput.classList.remove("is-dragover"),t=i.dataTransfer.files,e._addNewFile(i,t)},!1),this.emit("init",{init:!0,initDropZone:!0})}},{key:"_addNewFile",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.currentFiles=[],this.currentErrors=[];var r=i.length?i:e.target.files?e.target.files:null;if(r){if(this.options.maxNbFiles&&this.options.maxNbFiles<r.length)return this.currentErrors.push({error:new Error("Limit files !").code="TOO_MANY_FILES",message:this.text[this.options.language].textTooManyFiles}),void this._displayError();if(this.options.maxNbFiles&&this.options.maxNbFiles===this.filesList.length||this.options.maxNbFiles<this.filesList.length+r.length)return this.currentErrors.push({error:new Error("Limit files !").code="TOO_MANY_FILES",message:this.text[this.options.language].textTotalFiles}),void this._displayError();if(Object.values(r).forEach(function(e,i){var r=e.name.split(".").length>1?"."+e.name.split(".").pop().toLowerCase():null;t.options.fileExtensions.length&&-1===t.options.fileExtensions.indexOf(r)?t.currentErrors.push({error:new Error("Extension is not valid").code="EXTENSION",mimeType:r,file:e,message:t.text[t.options.language].textFileNotValid}):t._validSize(e)?t._validTotalSize(e)?t.currentFiles.push(e):t.currentErrors.push({error:new Error("Total size is too big").code="TOTAL_SIZE",file:e,fileSize:t._getFileSize(e.size),restSize:t._getRestSize(),message:t.text[t.options.language].textTotalFilesSize}):t.currentErrors.push({error:new Error("Size is too big").code="SIZE",file:e,fileSize:t._getFileSize(e.size),message:t.text[t.options.language].textFileTooBig})}),this.options.mimeType&&r.length===this.currentErrors.length&&this._displayError(),this.options.mimeType){var s=parseInt(1+this.currentErrors.length);this.currentFiles.forEach(function(e,i){t._getFormat(escape(e.name),e,function(i,n){var o=t._getMimeType(n);t.options.fileExtensions.length&&!t._isValidMimeType(o)&&(t.currentErrors.push({error:new Error("Mime Type is not valid").code="EXTENSION",mimeType:t._getExtension(e.name),file:e,message:t.text[t.options.language].textFileNotValid}),t.currentFiles.splice(currentFiles.findIndex(function(t){return t.name===e.name}),1)),r.length===s&&t._checkFiles(),s++})})}else this._checkFiles()}}},{key:"_checkFiles",value:function(){if(!this._validTotalSize(null,this.currentFiles))return this.currentErrors.push({error:new Error("Total size is too big").code="TOTAL_SIZE_MULTIPLE",currentFiles:this.currentFiles,restSize:this._getRestSize(),message:this.text[this.options.language].textTotalFilesSize}),void this._displayError();this.currentFiles.length&&this._onSuccess(this.currentFiles),this.currentErrors.length&&this._displayError()}},{key:"_onSuccess",value:function(){this.currentErrors.length||this._cleanError(),this.options.actionAjax?this._uploadFile(this.currentFiles):this._displayResult(this.currentFiles)}},{key:"_displayResult",value:function(e){this.filesList=this.filesList.concat(e),this._displayFile(),this.emit("success",{currentFiles:e,files:this.filesList,errors:this.currentErrors})}},{key:"_uploadFile",value:function(e){var t=this;if(this.progressBar){this.parentInput.classList.add("uploading"),this.progressBar.classList.add("active"),this.progressBarContent.style.width="0%";for(var i=new FormData,r=0;r<e.length;r++)i.append(this.fileInput.getAttribute("name")+"["+r+"]",e[r]);var s=new XMLHttpRequest;s.open("POST",this.options.actionAjax),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.upload.addEventListener("progress",function(e){if(e.lengthComputable){var i=e.loaded/e.total;i=parseInt(100*i),t.progressBarContent.style.width=i+"%",100===i&&setTimeout(function(){t.parentInput.classList.remove("uploading"),t.progressBar.classList.remove("active")},500)}}),s.onreadystatechange=function(i){4===s.readyState&&(200===s.status?t.displayResult(e):(progressBarContent.style.width="0%",t.currentErrors.push({error:new Error("Cannot upload file").code="UPLOAD",currentFiles:e,message:t.text[t.options.language].textErrorUpload}),t._displayError()))},s.send(i)}}},{key:"_displayFile",value:function(){var e=this;this.filesContent?this.filesContent.innerHTML="":(this.filesContent=document.createElement("div"),this.filesContent.classList.add("w-files__content"),this.wrapperFiles.appendChild(this.filesContent)),this.filesList.length?this.wrapperSelected.innerHTML=this.text[this.options.language].textAfterUpload:this.wrapperSelected.innerHTML=this.text[this.options.language].textBeforeUpload,this.restSize&&(this.restSize.innerHTML=this._getText(this.text[this.options.language].textSizeRest,this._getRestSize())),this.restFiles&&(this.restFiles.innerHTML=this._getText(this.text[this.options.language].textFileRest,this.options.maxNbFiles-this.filesList.length)),this.filesList.forEach(function(t){var i=document.createElement("div");i.classList.add("file"),i.innerHTML='<span class="file__delete"></span><span class="file__name">'+e._getFileName(t.name)+'</span><span class="file__size">('+e._getFileSize(t.size)+")</span>",e.filesContent.appendChild(i),i.querySelector(".file__delete").addEventListener("click",e._removeFile.bind(e))})}},{key:"_removeFile",value:function(e){var t=Array.prototype.slice.call(this.filesContent.children).indexOf(e.target.parentNode),i=this.filesList[t];this.filesList.splice(t,1),this._displayFile(),this.emit("delete",{file:i,filesList:this.filesList})}},{key:"_cleanError",value:function(){this.parentInput&&this.parentInput.classList.remove("error-upload"),this.wrapperError&&this.wrapperError.parentNode&&this.wrapperError.parentNode.removeChild(this.wrapperError)}},{key:"_getFormat",value:function(e,t,i){var r=this,s=new FileReader;this.parentInput.classList.add("loading"),s.onloadend=function(t){for(var s=new Uint8Array(t.target.result).subarray(0,4),n="",o=0;o<s.length;o++)n+=s[o].toString(16);r.parentInput.classList.remove("loading"),i(e,n)},s.readAsArrayBuffer(t)}},{key:"_getExtension",value:function(e){return e.split(".").length>1?"."+e.split(".").pop().toLowerCase():null}},{key:"_getMimeType",value:function(e){var t="";switch(e){case"89504e47":t=".png";break;case"47494638":t=".gif";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":t=".jpeg";break;case"ffd8ffdb":case"ffd8ffee":t=".jpg";break;case"41647265":t=".txt";break;case"25504446":t=".pdf";break;case"504b34":case"504b0304":t=[".zip",".xlsx",".pptx",".docx"];break;default:t="unknown"}return t}},{key:"_isValidMimeType",value:function(e){if(Array.isArray(e)){for(var t=0;t<=e.length;t++)if(-1!==this.options.fileExtensions.indexOf(e[t]))return!0;return!1}return-1!==this.options.fileExtensions.indexOf(e)}},{key:"_validSize",value:function(e){return e.size/1024/1024<this.options.maxFileSize}},{key:"_validTotalSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.filesList;return Math.round(this.maxTotalFilesSize)>=this._getTotalSize(e,t)}},{key:"_getText",value:function(e,t){return"string"==typeof t&&t.match(/\d+/)[0]>1||"number"==typeof t&&t>1?e.replace(/{{number}}/g,t).replace(/{{s}}/g,"s"):e.replace(/{{number}}/g,t).replace(/{{s}}/g,"")}},{key:"_getRestSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filesList;return this._getFileSize(this.maxTotalFilesSize-this._getTotalSize(null,e))}},{key:"_getTotalSize",value:function(e,t){var i=0;if(t.length)for(var r in t)i+=t[r].size;return e&&(i+=e.size),i}},{key:"_getFileSize",value:function(e){for(var t=new Array("Octets","Ko","Mo","Go"),i=0;e>900;)e/=1024,i++;return Math.round(100*e)/100+" "+t[i]}},{key:"_getFileName",value:function(e){var t=e.split(".").pop();return e.length-t.length-1>this.options.limitCharacters&&(e=e.substr(0,this.options.limitCharacters)+"(...)."+t),e}},{key:"_getFormData",value:function(e){for(var t=new FormData(e[0]),i=0;i<this.filesList.length;i++)t.append(fileInput.getAttribute("name")+"["+i+"]",this.filesList[i]);return t}},{key:"update",value:function(e){this.fileInput&&e&&Object.keys(e).length&&(1===Object.keys(e).length&&e.language?t.language=e.language:this.reset(e))}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.filesList=[],this.fileInput.value="",this.wrapperInformation&&(this._cleanError(),this.wrapperInformation.remove(),this.wrapperFiles&&this.wrapperFiles.remove(),this.filesContent=""),this.wrapperBtnUpload&&this.wrapperBtnUpload.remove(),this.init(e)}},{key:"_clear",value:function(){this.wrapperInformation&&(this.filesList=[],this._cleanError(),this._displayFile())}},{key:"_displayError",value:function(){var e=this;if(this.wrapperInformation){this._cleanError(),this.wrapperError=document.createElement("div"),this.wrapperError.classList.add("w-information__error");var t=this.currentErrors.filter(function(e){return"SIZE"===e.error});if(t.length){var i=document.createElement("span"),r=1===t.length?this.text[this.options.language].textFileTooBig:this.text[this.options.language].textMultipleFileTooBig;this.options.displayFilenameError&&t.forEach(function(t,i){r+=i?", "+e._getFileName(t.file.name):" "+e._getFileName(t.file.name)}),i.innerHTML=r,this.wrapperError.appendChild(i)}var s=this.currentErrors.filter(function(e){return"EXTENSION"===e.error});if(s.length){var n=document.createElement("span"),o=1===s.length?this.text[this.options.language].textFileNotValid:this.text[this.options.language].textMultipleFileNotValid;this.options.displayFilenameError&&s.forEach(function(t,i){o+=i?", "+e._getFileName(t.file.name):" "+e._getFileName(t.file.name)}),n.innerHTML=o,this.wrapperError.appendChild(n)}this.currentErrors.forEach(function(t){if("EXTENSION"!==t.error&&"SIZE"!==t.error){var i=document.createElement("span");i.innerHTML=t.message,e.wrapperError.appendChild(i)}}),this.wrapperInformation.appendChild(this.wrapperError),this.parentInput.classList.add("error-upload")}this.emit("error",{errors:this.currentErrors})}},{key:"_compareKeys",value:function(e,t){var i=Object.keys(e).sort(),r=Object.keys(t).sort();return JSON.stringify(i)===JSON.stringify(r)}},{key:"_mergeObjects",value:function(){for(var e={},t=0;t<arguments.length;t+=1)for(var i=arguments[t],r=Object.keys(i),s=0;s<r.length;s+=1)e[r[s]]=i[r[s]];return e}},{key:"files",get:function(){return this.filesList}},{key:"language",set:function(e){e&&this.options.language!==e&&this.fileInput&&(this.options.language=e,this._cleanError(),this.filesList.length?this.wrapperSelected.innerHTML=this.text[this.options.language].textAfterUpload:this.wrapperSelected.innerHTML=this.text[this.options.language].textBeforeUpload,this.options.displayRestSize&&(this.restSize.innerHTML=this._getText(this.text[this.options.language].textSizeRest,this._getRestSize())),this.options.displayMaxFileSize&&(this.maxFileSize.innerHTML=this._getText(this.text[this.options.language].textMaxFileSize,this._getFileSize(1048576*this.options.maxFileSize))),this.options.displayRestFiles&&(this.restFiles.innerHTML=this._getText(this.text[this.options.language].textFileRest,this.options.maxNbFiles)))}}]),t}()}])});